(function(e){var c=function(a,d,b,f){this.target=a;this.url=d;this.html=[];this.options=jQuery.extend({ssl:!1,limit:null,key:null,layoutTemplate:"<ul>{entries}</ul>",entryTemplate:'<li><a href="{url}">[{author}@{date}] {title}</a><br/>{shortBodyPlain}</li>',tokens:{},outputMode:"json"},b||{});this.callback=f};c.htmlTags="doctype,html,head,title,base,link,meta,style,script,noscript,body,article,nav,aside,section,header,footer,h1-h6,hgroup,address,p,hr,pre,blockquote,ol,ul,li,dl,dt,dd,figure,figcaption,div,table,caption,thead,tbody,tfoot,tr,th,td,col,colgroup,form,fieldset,legend,label,input,button,select,datalist,optgroup,option,textarea,keygen,output,progress,meter,details,summary,command,menu,del,ins,img,iframe,embed,object,param,video,audio,source,canvas,track,map,area,a,em,strong,i,b,u,s,small,abbr,q,cite,dfn,sub,sup,time,code,kbd,samp,var,mark,bdi,bdo,ruby,rt,rp,span,br,wbr".split(",");
c.prototype.load=function(a){var d="http"+(this.options.ssl?"s":"")+"://ajax.googleapis.com/ajax/services/feed/load?v=1.0&output="+this.options.outputMode+"&callback=?&q="+encodeURIComponent(this.url);null!=this.options.limit&&(d+="&num="+this.options.limit);null!=this.options.key&&(d+="&key="+this.options.key);e.getJSON(d,a)};c.prototype.render=function(){var a=this,d=this.options.entryTemplate;this.load(function(b){a.entries=b.responseData.feed.entries;jQuery(a.entries).each(function(){if(a.isRelevant(this)){var b=
a.evaluateStringForEntry(d,this);a.html.push(b)}});b=a.html.join("\n");b=a.options.entryTemplate?a.options.layoutTemplate.replace("{entries}",b):0==jQuery(b).length?jQuery("<div>"+b+"</div>"):jQuery(b);a.target.append(b);e.isFunction(a.callback)&&a.callback.call(a)})};c.prototype.evaluateStringForEntry=function(a,d){var b=a,c=this;jQuery(a.match(/(\{.*?\})/g)).each(function(){var a=this.toString();b=b.replace(a,c.getValueForToken(a,d))});return b};c.prototype.isRelevant=function(a){var d=this.getTokenMap(a);
return this.options.filter?this.options.filterLimit&&this.options.filterLimit==this.html.length?!1:this.options.filter(a,d):!0};c.prototype.getTokenMap=function(a){return jQuery.extend({url:a.link,author:a.author,date:a.publishedDate,title:a.title,body:a.content,shortBody:a.contentSnippet,bodyPlain:function(a){for(var a=a.content.replace(/<script[\\r\\\s\S]*<\/script>/mgi,"").replace(/<\/?[^>]+>/gi,""),b=0;b<c.htmlTags.length;b++)a=a.replace(RegExp("<"+c.htmlTags[b],"gi"),"");return a}(a),shortBodyPlain:a.contentSnippet.replace(/<\/?[^>]+>/gi,
""),index:jQuery.inArray(a,this.entries),totalEntries:this.entries.length,teaserImage:function(a){try{return a.content.match(/(<img.*?>)/gi)[0]}catch(b){return""}}(a),teaserImageUrl:function(a){try{return a.content.match(/(<img.*?>)/gi)[0].match(/src="(.*?)"/)[1]}catch(b){return""}}(a)},this.options.tokens)};c.prototype.getValueForToken=function(a,d){var b=this.getTokenMap(d),c=a.replace(/[\{\}]/g,""),c=b[c];if("undefined"!=typeof c)return"function"==typeof c?c(d,b):c;throw Error("Unknown token: "+
a);};e.fn.rss=function(a,d,b){(new c(this,a,d,b)).render()}})(jQuery);
